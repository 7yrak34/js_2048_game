var t={};class e{constructor(t=Array.from({length:e.GRID_SIZE},()=>Array(e.GRID_SIZE).fill(0))){this.state=t,this.score=this.state.reduce((t,e)=>{let s=0;for(let t of e)s+=t;return t+s},0)}static GRID_SIZE=4;static WIN_NUMBER=2048;static STATUS_IDLE="idle";static STATUS_PLAYING="playing";static STATUS_WIN="win";static STATUS_LOSE="lose";static PUSH_METHOD="push";static UNSHIFT_METHOD="unshift";static MOVE_DIRECTIONS={LEFT:"left",RIGHT:"right",UP:"up",DOWN:"down"};status=e.STATUS_IDLE;moveCells(t,s=!1){let a=0;return[t.map(t=>{let r=t.filter(t=>0!==t);s&&r.reverse();let[i,o]=this.mergeNumbers(r);for(a+=o;i.length<e.GRID_SIZE;)i.push(0);return s?i.reverse():i}),a]}moveLeft(){let[t,e]=this.moveCells(this.state);this.updateState(t,this.score+e)}moveRight(){let[t,e]=this.moveCells(this.state,!0);this.updateState(t,this.score+e)}moveUp(){let t=this.rotateMatrix(this.state),[e,s]=this.moveCells(t),a=this.rotateMatrix(e);this.updateState(a,this.score+s)}moveDown(){let t=this.rotateMatrix(this.state),[e,s]=this.moveCells(t,!0),a=this.rotateMatrix(e);this.updateState(a,this.score+s)}isMoveAvailable(){return this.state.some((t,e)=>t.some((s,a)=>0===s||a!==t.length-1&&s===this.state[e][a+1]||e!==this.state.length-1&&s===this.state[e+1][a]))}updateState(t,s){if(this.hasStateChanged(t)&&this.status===e.STATUS_PLAYING&&(this.state=t,this.score=s,this.addRandomCell()),this.state.some(t=>t.some(t=>t===e.WIN_NUMBER))){this.status=e.STATUS_WIN;return}this.isMoveAvailable()||(this.status=e.STATUS_LOSE)}rotateMatrix(t){let s=[];for(let a=0;a<e.GRID_SIZE;a++){let r=[];for(let s=0;s<e.GRID_SIZE;s++)r.push(t[s][a]);s.push(r)}return s}getScore(){return this.score}getState(){return this.state}getStatus(){return this.status}start(){this.status=e.STATUS_PLAYING,this.addRandomCell(),this.addRandomCell()}restart(){this.state=Array.from({length:e.GRID_SIZE},()=>Array(e.GRID_SIZE).fill(0)),this.status=e.STATUS_PLAYING,this.score=0,this.addRandomCell(),this.addRandomCell()}addRandomCell(){let t=[];if(this.state.forEach((e,s)=>{e.forEach((e,a)=>{0===e&&t.push({indexRow:s,indexCell:a})})}),!t.length)return;let e=Math.floor(0+Math.random()*(t.length-1+1-0)),{indexRow:s,indexCell:a}=t[e],r=.1>Math.random()?4:2;this.state[s].splice(a,1,r)}mergeNumbers(t){let e=[],s=0;for(let a=0;a<t.length;a++){let r=t[a],i=t[a+1];r===i?(e.push(r+i),s+=r+i,a++):e.push(r)}return[e,s]}hasStateChanged(t){return this.state.some((e,s)=>e.some((e,a)=>e!==t[s][a]))}}const s=new(t=e),a=document.querySelector(".button"),r=document.querySelector(".game-score"),[...i]=document.querySelectorAll(".field-cell"),o=document.querySelector(".message-start"),l=document.querySelector(".message-win"),h=document.querySelector(".message-lose");function n(e){for(let s=0;s<e.length;s++)for(let a=0;a<e[s].length;a++){let r=e[s][a],o=i[t.GRID_SIZE*s+a],l=0===r?"":r;o.textContent!==l.toString()&&(o.textContent=l,o.setAttribute("data-value",r))}switch(r.textContent=s.score,s.status){case t.STATUS_WIN:l.classList.remove("hidden");break;case t.STATUS_LOSE:h.classList.remove("hidden")}}a.addEventListener("click",()=>{a.classList.contains("restart")&&s.restart(),a.classList.contains("start")&&(s.start(),document.addEventListener("keydown",e=>{if(s.status===t.STATUS_PLAYING){switch(e.key){case"ArrowLeft":s.moveLeft();break;case"ArrowRight":s.moveRight();break;case"ArrowUp":s.moveUp();break;case"ArrowDown":s.moveDown()}n(s.state)}}),a.classList.remove("start"),a.textContent="Restart",a.classList.add("restart")),o.classList.add("hidden"),h.classList.add("hidden"),l.classList.add("hidden"),n(s.state)});
//# sourceMappingURL=index.2f56d89e.js.map
